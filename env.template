# ========================================
# Echoman 环境变量配置模板
# ========================================
# 复制此文件为 .env 并修改相应配置
# cp env.template .env

# ========== 基础配置 ==========
ENV=development
DEBUG=True
APP_NAME=Echoman

# ========== 数据库配置 ==========
DB_HOST=localhost
DB_PORT=5432
DB_USER=echoman
DB_PASSWORD=echoman_password
DB_NAME=echoman

# ========== Redis配置 ==========
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ========== Celery配置 ==========
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2

# ========== 采集调度配置 ==========
CRON_INGEST_SCHEDULE=0 8,10,12,14,16,18,20,22 * * *
CRON_HALFDAY_MERGE_SCHEDULE_NOON=15 12 * * *
CRON_HALFDAY_MERGE_SCHEDULE_NIGHT=15 22 * * *
CRON_GLOBAL_MERGE_SCHEDULE_NOON=30 12 * * *
CRON_GLOBAL_MERGE_SCHEDULE_NIGHT=30 22 * * *

# ========== 采集配置 ==========
ENABLED_PLATFORMS=weibo,zhihu,toutiao,sina,netease,baidu,hupu
FETCH_LIMIT_PER_PLATFORM=30
FETCH_TIMEOUT_SECONDS=10
FETCH_MAX_RETRIES=3

# ========================================
# LLM Provider 配置
# ========================================
# 选择以下之一作为 LLM_PROVIDER:
# - qwen (通义千问，推荐)
# - openai (OpenAI GPT)
# - azure (Azure OpenAI)
# - openai_compatible (本地部署：Ollama、LM Studio、vLLM 等)

LLM_PROVIDER=qwen

# ========== 选项 1: Qwen (通义千问) - 推荐 ==========
QWEN_API_KEY=sk-your-dashscope-api-key
QWEN_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1
QWEN_MODEL=qwen-plus
QWEN_EMBEDDING_MODEL=text-embedding-v3

# ========== 选项 2: OpenAI ==========
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL=text-embedding-3-large

# ========== 选项 3: Azure OpenAI ==========
AZURE_OPENAI_API_KEY=your-azure-key
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_DEPLOYMENT_NAME=gpt-4

# ========== 选项 4: OpenAI-Compatible (本地部署) ==========
# 使用 Ollama
OPENAI_COMPATIBLE_BASE_URL=http://localhost:11434/v1
OPENAI_COMPATIBLE_API_KEY=not-needed
OPENAI_COMPATIBLE_MODEL=llama3
OPENAI_COMPATIBLE_EMBEDDING_MODEL=nomic-embed-text
# 如果嵌入模型部署在不同地址可配置以下两项
OPENAI_COMPATIBLE_EMBEDDING_BASE_URL=""
OPENAI_COMPATIBLE_EMBEDDING_API_KEY=""

# 或使用 LM Studio
# OPENAI_COMPATIBLE_BASE_URL=http://localhost:1234/v1
# OPENAI_COMPATIBLE_API_KEY=not-needed
# OPENAI_COMPATIBLE_MODEL=your-model-name
# OPENAI_COMPATIBLE_EMBEDDING_MODEL=your-embedding-model

# 或使用 vLLM（支持单独的嵌入模型地址）
# OPENAI_COMPATIBLE_BASE_URL=http://localhost:8000/v1
# OPENAI_COMPATIBLE_API_KEY=your-api-key
# OPENAI_COMPATIBLE_MODEL=Qwen3-32B
# OPENAI_COMPATIBLE_EMBEDDING_MODEL=Qwen3-Embedding-8B
# OPENAI_COMPATIBLE_EMBEDDING_BASE_URL=http://localhost:8001/v1
# OPENAI_COMPATIBLE_EMBEDDING_API_KEY=your-api-key

# ========== LLM 调用参数 ==========
LLM_MAX_TOKENS=4096
LLM_TEMPERATURE=0.3
LLM_TIMEOUT_SECONDS=60
LLM_MAX_RETRIES=3
LLM_BATCH_SIZE=10

# ========== 向量配置 ==========
# 注意：不同的嵌入模型有不同的向量维度
# - text-embedding-v3: 1024
# - text-embedding-3-large: 3072
# - Qwen3-Embedding-8B: 4096
# - nomic-embed-text: 768
EMBEDDING_DIMENSION=4096
VECTOR_SIMILARITY_METRIC=cosine
VECTOR_INDEX_TYPE=ivfflat

# ========== Chroma向量数据库配置 ==========
# 向量数据库类型: chroma(推荐,支持高维向量) 或 postgres(受pgvector限制)
VECTOR_DB_TYPE=chroma
CHROMA_PERSIST_DIRECTORY=./data/chroma
CHROMA_COLLECTION_NAME=echoman_embeddings

# ========== 归并配置 ==========
HALFDAY_MERGE_MIN_OCCURRENCE=2
HALFDAY_MERGE_VECTOR_THRESHOLD=0.80
HALFDAY_MERGE_TITLE_THRESHOLD=0.4
GLOBAL_MERGE_VECTOR_THRESHOLD=0.80
GLOBAL_MERGE_CONFIDENCE_THRESHOLD=0.75
GLOBAL_MERGE_TOPK_CANDIDATES=3
GLOBAL_MERGE_SIMILARITY_THRESHOLD=0.5
GLOBAL_MERGE_NEW_TOPIC_KEEP_RATIO=1.0

# ========== 热度归一化配置 ==========
HEAT_NORMALIZATION_METHOD=minmax_weighted
PLATFORM_WEIGHTS={"weibo":1.2,"zhihu":1.1,"baidu":1.1,"toutiao":1.0,"netease":0.9,"sina":0.8,"hupu":0.8}

# ========== RAG对话配置 ==========
RAG_TOPK=5
CITATION_REQUIRED=True
RAG_RERANK_ENABLED=True
RAG_MAX_CONTEXT_LENGTH=8000

# ========== 自由模式配置 ==========
FREE_MODE_INVITE_TTL_DAYS=7
FREE_MODE_TOKEN_TTL_HOURS=168

# ========== 分类配置 ==========
CLASSIFIER_PROVIDER=llm
CLASSIFIER_MODEL=qwen-plus
CLASSIFIER_THRESHOLD=0.6
CLASSIFIER_DEBOUNCE_DELTA=0.25
CATEGORY_METRICS_WINDOW_DAYS=30

# ========== 安全配置 ==========
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
