# Echoman å½’å¹¶é€»è¾‘è¯¦è§£

## æ¦‚è¿°

Echomané‡‡ç”¨**æ¯æ—¥ä¸‰æ¬¡ï¼Œæ¯æ¬¡ä¸¤é˜¶æ®µå½’å¹¶æœºåˆ¶**æ¥å¤„ç†å¤šå¹³å°çƒ­ç‚¹æ•°æ®ï¼Œæœ‰æ•ˆè¿‡æ»¤å™ªéŸ³ã€è¿½è¸ªçƒ­ç‚¹æ¼”è¿›ã€æ„å»ºä¸»é¢˜æ—¶é—´çº¿ã€‚

### å½’å¹¶æ‰§è¡Œé¢‘ç‡
æ¯æ—¥æ‰§è¡Œ **ä¸‰æ¬¡å½’å¹¶**ï¼Œåˆ†ä¸ºï¼š
- **ä¸Šåˆå½’å¹¶**ï¼ˆ12:15-12:30ï¼‰ï¼šå¤„ç† 8:00-12:00 çš„é‡‡é›†æ•°æ®
- **ä¸‹åˆå½’å¹¶**ï¼ˆ18:15-18:30ï¼‰ï¼šå¤„ç† 14:00-18:00 çš„é‡‡é›†æ•°æ®
- **å‚æ™šå½’å¹¶**ï¼ˆ22:15-22:30ï¼‰ï¼šå¤„ç† 20:00-22:00 çš„é‡‡é›†æ•°æ®

### æ¯æ¬¡å®Œæ•´å½’å¹¶åŒ…å«ä¸¤ä¸ªé˜¶æ®µ
1. **é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶**
   - æ—¶é—´ï¼š12:15 / 18:15 /22:15
   - é€»è¾‘ï¼šå½“å¤©æœ¬æ¬¡å½’å¹¶æ—¶é—´èŒƒå›´ä¸­ï¼Œé‡‡é›†åˆ°çš„æ–°äº‹ä»¶ï¼ŒæŒ‰ç…§ä»¥ä¸‹è§„åˆ™å½’å¹¶ï¼š1ã€é€šè¿‡å‘é‡èšç±» + LLMåˆ¤å®šï¼Œå°†ç›¸ä¼¼çš„æ–°é—»å½’ä¸ºä¸€ç»„ï¼›2ã€occurrence_count = è¯¥ç»„å†…çš„itemæ•°é‡ï¼ˆè¡¨ç¤ºæœ‰å¤šå°‘æ¡source_itemåœ¨æŠ¥é“åŒä¸€äº‹ä»¶æˆ–ç´§å¯†ç›¸å…³çš„äº‹ä»¶ï¼‰ï¼›3ã€åªä¿ç•™occurrence_count >= 2çš„item
   - ç›®æ ‡ï¼šå¯¹æ–°çˆ¬å–çš„æ•°æ®å»å™ª
   - è¾“å‡ºï¼šä¿ç•™çš„çœŸå®çƒ­ç‚¹äº‹ä»¶
   
2. **é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶**
   - æ—¶é—´ï¼šé˜¶æ®µä¸€å®Œæˆåå¼€å§‹
   - ç›®æ ‡ï¼šå°†é˜¶æ®µä¸€ä¿ç•™çš„itemä¸å†å² Topic åº“æ¯”å¯¹ï¼Œå…³è”æ¼”è¿›æˆ–åˆ›å»ºæ–°ä¸»é¢˜
   - è¾“å‡ºï¼šæ›´æ–°çš„ Topics å’Œæ—¶é—´çº¿

## æ ¸å¿ƒè®¾è®¡æ€æƒ³

### 1. ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µå½’å¹¶ï¼Ÿ

#### å•é˜¶æ®µå½’å¹¶çš„é—®é¢˜
- **å™ªéŸ³è¿‡å¤š**ï¼šå•æ¬¡é‡‡é›†å¯èƒ½æŠ“å–åˆ°å¶ç„¶å‡ºç°çš„è¯é¢˜
- **éš¾ä»¥åˆ¤å®š**ï¼šæ— æ³•åŒºåˆ†çœŸå®çƒ­ç‚¹å’ŒçŸ­æš‚æ³¢åŠ¨
- **æ€§èƒ½å¼€é”€**ï¼šæ¯æ¬¡ä¸å…¨é‡å†å²æ¯”å¯¹æˆæœ¬é«˜

#### ä¸¤é˜¶æ®µå½’å¹¶çš„ä¼˜åŠ¿

**é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶**ï¼ˆå»å™ªè¿‡æ»¤ï¼‰
  - æ—¶é—´çª—å£ï¼šæ¯ä¸ªå½’å¹¶å‘¨æœŸå†…ï¼ˆ2-3æ¬¡é‡‡é›†ï¼‰
    - ä¸Šåˆï¼š8:00ã€10:00ã€12:00ï¼ˆ3æ¬¡é‡‡é›†ï¼‰
    - ä¸‹åˆï¼š14:00ã€16:00ã€18:00ï¼ˆ3æ¬¡é‡‡é›†ï¼‰
    - å‚æ™šï¼š20:00ã€22:00ï¼ˆ2æ¬¡é‡‡é›†ï¼‰
  - ç›®æ ‡ï¼šå»å™ªã€éªŒè¯çœŸå®æ€§
  - ç­›é€‰æ ‡å‡†ï¼š**å‡ºç°æ¬¡æ•° â‰¥ 2**
  - æ•ˆæœï¼šè¿‡æ»¤19.8%çš„å™ªéŸ³æ•°æ®
  - èµ„æºæ¶ˆè€—ï¼šä½ï¼ˆä»…å¤„ç†æ–°é‡‡é›†æ•°æ®ï¼‰

**é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶**ï¼ˆå…³è”æ¼”è¿›ï¼‰
  - æ—¶é—´çª—å£ï¼šä¸å†å²åº“æ¯”å¯¹
  - ç›®æ ‡ï¼šå…³è”æ¼”è¿›ã€æ„å»ºæ—¶é—´çº¿
  - åˆ¤å®šæ ‡å‡†ï¼š**å‘é‡ç›¸ä¼¼åº¦ + LLMåˆ¤å®š**
  - æ•ˆæœï¼š42.4%çš„æ–°äº‹ä»¶å½’å…¥å·²æœ‰ä¸»é¢˜
  - èµ„æºæ¶ˆè€—ï¼šé«˜ï¼ˆéœ€è¦å‘é‡æ£€ç´¢ + LLMåˆ¤å®šï¼‰
  - ä¼˜åŒ–ç­–ç•¥ï¼šæ‰¹é‡å¤„ç†ã€é™æµã€å€™é€‰æ•°é‡é™åˆ¶

### 2. çƒ­åº¦å½’ä¸€åŒ–çš„å¿…è¦æ€§

#### é—®é¢˜
- ä¸åŒå¹³å°çƒ­åº¦å€¼é‡çº²ä¸åŒï¼ˆå¾®åšç™¾ä¸‡çº§ï¼ŒçŸ¥ä¹åƒçº§ï¼‰
- éƒ¨åˆ†å¹³å°æ— çƒ­åº¦å€¼ï¼ˆæ–°æµªã€è™æ‰‘ï¼‰
- éœ€è¦ç»Ÿä¸€çš„çƒ­åº¦å æ¯”ç”¨äºå¯¹æ¯”å’Œæ’åº

#### è§£å†³æ–¹æ¡ˆï¼šä¸‰æ­¥å½’ä¸€åŒ–
1. **å¹³å°å†…Min-Maxå½’ä¸€åŒ–**ï¼šæ¶ˆé™¤é‡çº²å·®å¼‚
2. **å¹³å°æƒé‡åŠ æƒ**ï¼šä½“ç°å¹³å°å½±å“åŠ›
3. **å…¨å±€å½’ä¸€åŒ–**ï¼šæ¯ä¸ªå½’å¹¶å‘¨æœŸå†…æ‰€æœ‰äº‹ä»¶çƒ­åº¦å’Œä¸º1.0

> ğŸ“– **è¯¦ç»†ç®—æ³•è¯´æ˜**ï¼šå®Œæ•´çš„çƒ­åº¦å½’ä¸€åŒ–ç®—æ³•ã€å¹³å°æƒé‡é…ç½®ã€ä»£ç å®ç°ç­‰è¯¦è§ [ECHO_METRICS_CALCULATION.md](ECHO_METRICS_CALCULATION.md#äºŒå›å£°å¼ºåº¦echo-intensity)

## è¯¦ç»†æµç¨‹

### æ—¶é—´çº¿ï¼ˆå•æ—¥ç¤ºä¾‹ï¼‰

```
ã€ä¸ŠåŠæ—¥å½’å¹¶ï¼ˆ12:15-12:30ï¼‰ã€‘
08:00 â†’ é‡‡é›†æ‰¹æ¬¡ #1 â†’ æš‚å­˜ï¼ˆæ ‡è®° AMï¼‰
10:00 â†’ é‡‡é›†æ‰¹æ¬¡ #2 â†’ æš‚å­˜ï¼ˆæ ‡è®° AMï¼‰
12:00 â†’ é‡‡é›†æ‰¹æ¬¡ #3 â†’ æš‚å­˜ï¼ˆæ ‡è®° AMï¼‰

12:15 â†’ ã€é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶ã€‘è§¦å‘
  â”œâ”€ çƒ­åº¦å½’ä¸€åŒ–ï¼ˆMin-Max + å¹³å°æƒé‡ï¼‰
  â”œâ”€ å‘é‡èšç±»ï¼ˆç›¸ä¼¼åº¦ > 0.85ï¼‰
  â”œâ”€ LLMåˆ¤å®šï¼ˆåŒç»„äº‹ä»¶ç¡®è®¤ï¼‰
  â”œâ”€ å‡ºç°æ¬¡æ•°ç­›é€‰ï¼ˆâ‰¥2æ¬¡ä¿ç•™ï¼‰
  â””â”€ è¾“å‡º: å»å™ªåçš„çœŸå®çƒ­ç‚¹äº‹ä»¶ â†’ pending_global_merge

12:30 â†’ ã€é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶ã€‘è§¦å‘
  â”œâ”€ å‘é‡æ£€ç´¢ï¼ˆChromaå¬å› active topics Top-10ï¼‰
  â”œâ”€ LLMå…³è”åˆ¤å®šï¼ˆæ˜¯å¦ä¸ºå·²æœ‰ä¸»é¢˜è¿›å±•ï¼‰
  â”œâ”€ å†³ç­–ï¼šmergeï¼ˆè¿½åŠ åˆ°å·²æœ‰Topicï¼‰or newï¼ˆåˆ›å»ºæ–°Topicï¼‰
  â”œâ”€ çƒ­åº¦æ›´æ–°ï¼ˆtopic_halfday_heat è¡¨ï¼‰
  â”œâ”€ åˆ†ç±»ä¸æ‘˜è¦ï¼ˆLLMï¼Œå¯é€‰ï¼‰
  â”œâ”€ æ€§èƒ½ä¼˜åŒ–ï¼šæ‰¹é‡å¤„ç†ã€é™æµã€å€™é€‰æ•°é‡é™åˆ¶
  â””â”€ é€šçŸ¥å‰ç«¯ï¼ˆç¬¬1æ¬¡æ›´æ–°ï¼‰

ã€ä¸‹åˆå½’å¹¶ï¼ˆ18:15-18:30ï¼‰ã€‘
14:00 â†’ é‡‡é›†æ‰¹æ¬¡ #4 â†’ æš‚å­˜ï¼ˆæ ‡è®° PMï¼‰
16:00 â†’ é‡‡é›†æ‰¹æ¬¡ #5 â†’ æš‚å­˜ï¼ˆæ ‡è®° PMï¼‰
18:00 â†’ é‡‡é›†æ‰¹æ¬¡ #6 â†’ æš‚å­˜ï¼ˆæ ‡è®° PMï¼‰

18:15 â†’ ã€é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶ã€‘è§¦å‘
  â””â”€ ï¼ˆåŒä¸Šåˆæµç¨‹ï¼‰

18:30 â†’ ã€é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶ã€‘è§¦å‘
  â””â”€ ï¼ˆåŒä¸Šåˆæµç¨‹ï¼Œç¬¬2æ¬¡æ›´æ–°ï¼‰

ã€å‚æ™šå½’å¹¶ï¼ˆ22:15-22:30ï¼‰ã€‘
20:00 â†’ é‡‡é›†æ‰¹æ¬¡ #7 â†’ æš‚å­˜ï¼ˆæ ‡è®° EVEï¼‰
22:00 â†’ é‡‡é›†æ‰¹æ¬¡ #8 â†’ æš‚å­˜ï¼ˆæ ‡è®° EVEï¼‰

22:15 â†’ ã€é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶ã€‘è§¦å‘
  â””â”€ ï¼ˆåŒä¸Šåˆæµç¨‹ï¼‰

22:30 â†’ ã€é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶ã€‘è§¦å‘
  â””â”€ ï¼ˆåŒä¸Šåˆæµç¨‹ï¼Œç¬¬3æ¬¡æ›´æ–°ï¼‰
```

## é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶ï¼ˆNew Event Mergeï¼‰

**åŸç§°**ï¼šåŠæ—¥å½’å¹¶ï¼ˆHalfday Mergeï¼‰

### ç›®æ ‡
å¯¹æ–°çˆ¬å–çš„æ•°æ®å»å™ªï¼ŒéªŒè¯çœŸå®çƒ­ç‚¹ã€‚

### è¾“å…¥
- **ä¸Šåˆï¼ˆAMï¼‰**ï¼š8:00ã€10:00ã€12:00 ä¸‰æ¬¡é‡‡é›†ï¼ˆçº¦60-90æ¡/æ¬¡ï¼Œå…±180-270æ¡ï¼‰
- **ä¸‹åˆï¼ˆPMï¼‰**ï¼š14:00ã€16:00ã€18:00 ä¸‰æ¬¡é‡‡é›†ï¼ˆçº¦60-90æ¡/æ¬¡ï¼Œå…±180-270æ¡ï¼‰
- **å‚æ™šï¼ˆEVEï¼‰**ï¼š20:00ã€22:00 ä¸¤æ¬¡é‡‡é›†ï¼ˆçº¦60-90æ¡/æ¬¡ï¼Œå…±120-180æ¡ï¼‰

### æ­¥éª¤è¯¦è§£

#### æ­¥éª¤1ï¼šçƒ­åº¦å½’ä¸€åŒ–

å¯¹æœ¬å½’å¹¶å‘¨æœŸå†…é‡‡é›†çš„æ‰€æœ‰æ•°æ®è¿›è¡Œçƒ­åº¦å½’ä¸€åŒ–å¤„ç†ï¼Œä¸ºåç»­èšç±»å’Œç­›é€‰æä¾›ç»Ÿä¸€çš„çƒ­åº¦åŸºå‡†ã€‚

**å½’ä¸€åŒ–æµç¨‹**ï¼ˆè¯¦è§ [ECHO_METRICS_CALCULATION.md](ECHO_METRICS_CALCULATION.md#äºŒå›å£°å¼ºåº¦echo-intensity) ç¬¬2.2èŠ‚ï¼‰ï¼š

1. **å¹³å°å†…Min-Maxå½’ä¸€åŒ–**ï¼šæ¶ˆé™¤ä¸åŒå¹³å°é‡çº²å·®å¼‚ï¼ˆå¾®åšç™¾ä¸‡çº§ vs çŸ¥ä¹åƒçº§ï¼‰
2. **å¹³å°æƒé‡åŠ æƒ**ï¼šä½“ç°å¹³å°å½±å“åŠ›å·®å¼‚ï¼ˆå¾®åš1.2ã€çŸ¥ä¹1.1ã€å¤´æ¡1.0ç­‰ï¼‰
3. **å…¨å±€å½’ä¸€åŒ–**ï¼šä½¿å½’å¹¶å‘¨æœŸå†…æ‰€æœ‰äº‹ä»¶çƒ­åº¦å’Œä¸º 1.0ï¼Œä¾¿äºå¯¹æ¯”

**å…³é”®ç‚¹**ï¼š
- **å½’ä¸€åŒ–èŒƒå›´** = **å½’å¹¶å‘¨æœŸ**ï¼ˆAM/PM/EVEï¼‰ï¼Œå¿…é¡»ç­‰æ‰€æœ‰é‡‡é›†å®Œæˆåç»Ÿä¸€å¤„ç†
- **å½’ä¸€åŒ–ç»“æœ**ï¼šæ¯ä¸ªäº‹ä»¶çš„ `heat_normalized` å€¼åœ¨ 0-1 ä¹‹é—´ï¼Œè¡¨ç¤ºå…¶åœ¨è¯¥å‘¨æœŸå†…çš„çƒ­åº¦å æ¯”
- **ä»£ç ä½ç½®**ï¼š`backend/app/services/heat_normalization.py`

**ç¤ºä¾‹**ï¼š
```
ä¸Šåˆå½’å¹¶ï¼ˆ3æ¬¡é‡‡é›†ï¼Œå…±200ä¸ªäº‹ä»¶ï¼‰ï¼š
- å¾®åšçƒ­ç‚¹A: heat_normalized = 0.025 (2.5%)
- çŸ¥ä¹çƒ­ç‚¹B: heat_normalized = 0.018 (1.8%)
- æ–°æµªçƒ­ç‚¹C: heat_normalized = 0.008 (0.8%)
... å…¶ä»–197ä¸ªäº‹ä»¶ ...
æ€»å’Œ: 1.0 (100%)
```

#### æ­¥éª¤2ï¼šå‘é‡èšç±»

**2.1 æ ‡é¢˜å‘é‡åŒ–**ï¼ˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Qwen3-Embedding-8Bï¼‰
```python
# æµ‹è¯•ç¯å¢ƒï¼šä½¿ç”¨æ–‡æœ¬ç›¸ä¼¼åº¦
for item in items:
    item.embedding = embedding_model.encode(item.title)
```

**2.2 ç›¸ä¼¼åº¦èšç±»**
```python
groups = []
ungrouped = items.copy()

while ungrouped:
    seed = ungrouped.pop(0)
    group = [seed]
    
    remaining = []
    for item in ungrouped:
        similarity = cosine_similarity(seed.embedding, item.embedding)
        
        if similarity >= 0.85:  # ç›¸ä¼¼åº¦é˜ˆå€¼
            group.append(item)
        else:
            remaining.append(item)
    
    ungrouped = remaining
    groups.append(group)
```

**æ ‡é¢˜ç›¸ä¼¼åº¦ç¤ºä¾‹**ï¼š
```
ç›¸ä¼¼åº¦ 1.0:  "ELLEçº¢æ¯¯" vs "ELLEçº¢æ¯¯"
ç›¸ä¼¼åº¦ 0.92: "è®¸ç»é›„é€ä¸–" vs "æ¬¢å–œå“¥è®¸ç»é›„é€ä¸–"
ç›¸ä¼¼åº¦ 0.67: "ELLEçº¢æ¯¯" vs "ELLEæ™šå®´"
ç›¸ä¼¼åº¦ 0.35: "è®¸ç»é›„é€ä¸–" vs "è®¸ç»é›„å®¶äººæ„Ÿè°¢"
```

#### æ­¥éª¤3ï¼šLLMæ‰¹é‡åˆ¤å®šï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**Promptç¤ºä¾‹**ï¼š
```
åˆ¤æ–­ä»¥ä¸‹æ–°é—»æ¡ç›®æ˜¯å¦ä¸ºåŒä¸€äº‹ä»¶çš„ä¸åŒæŠ¥é“ï¼ˆåŒä¸€å½’å¹¶å‘¨æœŸå†…é‡‡é›†ï¼‰ï¼š

[Item 1] 
æ ‡é¢˜ï¼šè®¸ç»é›„é€ä¸–
å¹³å°ï¼šå¾®åš
æ—¶é—´ï¼š08:00
æ‘˜è¦ï¼šæ¼”å‘˜è®¸ç»é›„ä»Šæ™¨å»ä¸–ï¼Œäº«å¹´76å²

[Item 2]
æ ‡é¢˜ï¼šæ¬¢å–œå“¥è®¸ç»é›„ç—…é€
å¹³å°ï¼šçŸ¥ä¹
æ—¶é—´ï¼š10:00
æ‘˜è¦ï¼š76å²TVBæ¼”å‘˜ã€Œæ¬¢å–œå“¥ã€è®¸ç»é›„ç—…é€ï¼Œæ›¾å‚æ¼”ã€Šä½¿å¾’è¡Œè€…ã€‹

[Item 3]
æ ‡é¢˜ï¼šè®¸ç»é›„å®¶äººæ„Ÿè°¢å¤§å®¶
å¹³å°ï¼šç™¾åº¦
æ—¶é—´ï¼š12:00
æ‘˜è¦ï¼šè®¸ç»é›„å®¶äººå‘æ–‡æ„Ÿè°¢å¤§å®¶å…³å¿ƒ

è¦æ±‚è¾“å‡ºJSONï¼š
{
  "is_same_event": true,
  "group_id": "halfday_merge_001",
  "confidence": 0.95,
  "reason": "ä¸‰æ¡æ–°é—»å‡æŠ¥é“è®¸ç»é›„é€ä¸–è¿™ä¸€äº‹ä»¶ï¼Œæ ¸å¿ƒä¸»é¢˜ä¸€è‡´"
}
```

**LLMå“åº”ç¤ºä¾‹**ï¼š
```json
{
  "is_same_event": true,
  "group_id": "halfday_merge_001",
  "items": [1, 2, 3],
  "confidence": 0.95,
  "reason": "ä¸‰æ¡æ–°é—»å‡æŠ¥é“è®¸ç»é›„é€ä¸–è¿™ä¸€äº‹ä»¶ï¼Œæ ¸å¿ƒä¸»é¢˜ä¸€è‡´",
  "period": "2025-10-29_AM"
}
```

#### æ­¥éª¤4ï¼šæ ‡è®°å½’å¹¶ç»„

```python
for idx, group in enumerate(groups):
    group_id = f"halfday_group_{idx:03d}"
    occurrence = len(group)
    
    for item in group:
        item.halfday_merge_group_id = group_id
        item.occurrence_count = occurrence
```

#### æ­¥éª¤5ï¼šå‡ºç°æ¬¡æ•°ç­›é€‰

**å…³é”®è§„åˆ™**ï¼š**å‡ºç°æ¬¡æ•° â‰¥ 2** æ‰ä¿ç•™

```python
kept_items = [
    item for item in items 
    if item.occurrence_count >= 2
]

dropped_items = [
    item for item in items 
    if item.occurrence_count < 2
]
```

**ç­›é€‰åŸç†**ï¼š
- çœŸå®çƒ­ç‚¹ä¼šåœ¨å¤šæ¬¡é‡‡é›†ä¸­åå¤å‡ºç°
- å•æ¬¡å‡ºç°çš„è¯é¢˜å¯èƒ½æ˜¯ï¼š
  - å¶ç„¶æ³¢åŠ¨
  - å¹³å°æ¨èç®—æ³•çš„éšæœºæ€§
  - çŸ­æš‚çš„æµé‡å†²å‡»
  - é‡‡é›†é”™è¯¯

**å®æµ‹æ•ˆæœ**ï¼ˆ2025-10-28æ•°æ®ï¼‰ï¼š
```
ä¸ŠåŠæ—¥ï¼ˆ3æ¬¡é‡‡é›†ï¼‰ï¼š
  è¾“å…¥: 459æ¡
  å½¢æˆ: 227ä¸ªå½’å¹¶ç»„
  ä¿ç•™: 127ä¸ªç»„ï¼ˆ359æ¡ï¼Œ78.2%ï¼‰
  ä¸¢å¼ƒ: 100ä¸ªç»„ï¼ˆ100æ¡ï¼Œ21.8%ï¼‰

ä¸‹åŠæ—¥ï¼ˆ5æ¬¡é‡‡é›†ï¼‰ï¼š
  è¾“å…¥: 459æ¡
  å½¢æˆ: 214ä¸ªå½’å¹¶ç»„
  ä¿ç•™: 132ä¸ªç»„ï¼ˆ377æ¡ï¼Œ82.1%ï¼‰
  ä¸¢å¼ƒ: 82ä¸ªç»„ï¼ˆ82æ¡ï¼Œ17.9%ï¼‰
```

**ä¿ç•™ç¤ºä¾‹**ï¼ˆå‡ºç°â‰¥2æ¬¡ï¼‰ï¼š
```
âœ… ä¿ç•™ï¼š
- "ELLEçº¢æ¯¯" - å‡ºç°4æ¬¡ï¼ˆå¾®åš3æ¬¡ + æ–°æµª1æ¬¡ï¼‰
- "è®¸ç»é›„é€ä¸–" - å‡ºç°5æ¬¡ï¼ˆå¾®åš2æ¬¡ + çŸ¥ä¹1æ¬¡ + ç™¾åº¦2æ¬¡ï¼‰
- "åŠ¨ç‰©è¡€åº“ç°è‰²äº§ä¸š" - å‡ºç°8æ¬¡ï¼ˆå¤šå¹³å°å¤šæ¬¡æŠ¥é“ï¼‰

âŒ ä¸¢å¼ƒï¼ˆä»…å‡ºç°1æ¬¡ï¼‰ï¼š
- "ç„•æ–°ææ°ª7Xå®¶åº­è±ªåæ–°æ ‡æ†" - ä»…å¾®åšå¹¿å‘Š
- "offerç»“æŸåå®ä¹ ç”Ÿç°çŠ¶" - å•æ¬¡çƒ­ç‚¹
- "æ»¡å¤©æ˜Ÿç°ªèŠ±" - çŸ­æš‚è¯é¢˜
```

### è¾“å‡º
- ä¿ç•™çš„ `source_items`ï¼ˆæ ‡è®° `pending_global_merge`ï¼‰
- æ¯ä¸ªitemå¸¦æœ‰ `halfday_merge_group_id` å’Œ `occurrence_count`
- å‡†å¤‡è¿›å…¥æ•´ä½“å½’å¹¶

## é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶ï¼ˆGlobal Mergeï¼‰

### ç›®æ ‡
å°†æ–°äº‹ä»¶å½’å¹¶åçš„ç»“æœä¸å†å²ä¸»é¢˜åº“æ¯”å¯¹ï¼Œå…³è”æ¼”è¿›æˆ–åˆ›å»ºæ–°ä¸»é¢˜ã€‚

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
ä¸ºé¿å…èµ„æºæ¶ˆè€—è¿‡å¤§ï¼Œé‡‡ç”¨ä»¥ä¸‹ä¼˜åŒ–æªæ–½ï¼š
1. **æ‰¹é‡å¤„ç†**ï¼šæ¯æ¬¡æœ€å¤šå¤„ç† 50 ä¸ªæ–°äº‹ä»¶ç»„
2. **å‘é‡æ£€ç´¢é™åˆ¶**ï¼šæ¯ä¸ªäº‹ä»¶æœ€å¤šå¬å› Top-10 å€™é€‰ Topics
3. **LLM é™æµ**ï¼šæ‰¹é‡åˆ¤å®šæ—¶åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å•æ¬¡è¯·æ±‚è¿‡å¤§
4. **Token ç®¡ç†**ï¼šæ™ºèƒ½æˆªæ–­è¿‡é•¿å†…å®¹ï¼Œæ§åˆ¶åœ¨ Qwen3-32B çš„ 32k é™åˆ¶å†…
5. **è¶…æ—¶æ§åˆ¶**ï¼šå•ä¸ªå½’å¹¶ä»»åŠ¡æœ€é•¿æ‰§è¡Œ 15 åˆ†é’Ÿ
6. **èµ„æºç›‘æ§**ï¼šè®°å½•æ¯æ¬¡å½’å¹¶çš„è€—æ—¶å’Œèµ„æºä½¿ç”¨æƒ…å†µ

### è¾“å…¥
- æ–°äº‹ä»¶å½’å¹¶åçš„äº‹ä»¶ç»„ï¼ˆæ¯ç»„ä»£è¡¨ä¸€ä¸ªç»è¿‡éªŒè¯çš„çœŸå®çƒ­ç‚¹ï¼‰
- å·²æœ‰çš„ `topics` è¡¨ï¼ˆactiveçŠ¶æ€çš„ä¸»é¢˜ï¼‰

### æ­¥éª¤è¯¦è§£

#### æ­¥éª¤1ï¼šæ–°äº‹ä»¶åˆ†ç»„

```python
new_groups = {}
for item in kept_items:
    group_id = item.halfday_merge_group_id
    if group_id not in new_groups:
        new_groups[group_id] = []
    new_groups[group_id].append(item)

# ç»“æœï¼š
# {
#   "halfday_group_000": [item1, item2, item3, item4],  # ELLEçº¢æ¯¯
#   "halfday_group_001": [item5, item6, item7],         # è®¸ç»é›„é€ä¸–
#   ...
# }
```

#### æ­¥éª¤2ï¼šå‘é‡æ£€ç´¢å€™é€‰ä¸»é¢˜

**2.1 å‘é‡åŒ–æ–°äº‹ä»¶**ï¼ˆä½¿ç”¨Qwen3-Embedding-8Bï¼‰
```python
for group_id, group_items in new_groups:
    representative = group_items[0]  # å–ä»£è¡¨æ€§item
    new_event_embedding = embedding_model.encode(representative.title)
```

**2.2 pgvectoræ£€ç´¢**
```sql
-- å¬å›ä¸æ–°äº‹ä»¶ç›¸ä¼¼çš„Top-10 active topics
SELECT 
    id, title_key, embedding,
    1 - (embedding <=> :new_event_embedding) AS similarity
FROM topics
WHERE status = 'active'
ORDER BY embedding <=> :new_event_embedding
LIMIT 10;
```

**æ£€ç´¢ç¤ºä¾‹**ï¼š
```
æ–°äº‹ä»¶ï¼š"è®¸ç»é›„å®¶äººæ„Ÿè°¢å¤§å®¶å…³å¿ƒ"

å¬å›å€™é€‰ï¼ˆTop-10ï¼‰ï¼š
1. "æ¬¢å–œå“¥è®¸ç»é›„é€ä¸–"    - ç›¸ä¼¼åº¦: 0.87
2. "76å²TVBæ¼”å‘˜è®¸ç»é›„ç—…é€" - ç›¸ä¼¼åº¦: 0.82
3. "ä¼—æ˜Ÿæ‚¼å¿µè®¸ç»é›„"       - ç›¸ä¼¼åº¦: 0.76
4. "ä½˜è¯—æ›¼è°ˆè®¸ç»é›„è½æ³ª"   - ç›¸ä¼¼åº¦: 0.72
5. ...ï¼ˆå…¶ä»–æ— å…³ä¸»é¢˜ï¼‰     - ç›¸ä¼¼åº¦: < 0.50
```

#### æ­¥éª¤3ï¼šLLMå…³è”åˆ¤å®š

**Promptç¤ºä¾‹**ï¼š
```
åˆ¤æ–­æ–°äº‹ä»¶æ˜¯å¦ä¸ºå·²æœ‰ä¸»é¢˜çš„æ–°è¿›å±•ï¼š

ã€æ–°äº‹ä»¶ã€‘
æ ‡é¢˜ï¼šè®¸ç»é›„å®¶äººæ„Ÿè°¢å¤§å®¶å…³å¿ƒ
æ‘˜è¦ï¼šè®¸ç»é›„å®¶äººå‘æ–‡æ„Ÿè°¢å¤§å®¶å…³å¿ƒ
åŠæ—¥çƒ­åº¦ï¼š0.08
æ—¥æœŸï¼š2025-10-29
æ—¶æ®µï¼šPM
å‡ºç°æ¬¡æ•°ï¼š3æ¬¡
è¦†ç›–å¹³å°ï¼šå¾®åšã€ç™¾åº¦

ã€å€™é€‰ä¸»é¢˜ 1ã€‘
IDï¼št_123
æ ‡é¢˜ï¼šæ¬¢å–œå“¥è®¸ç»é›„é€ä¸–
æ‘˜è¦ï¼šæ¼”å‘˜è®¸ç»é›„ä»Šæ™¨å»ä¸–ï¼Œäº«å¹´76å²...
æœ€åæ´»è·ƒï¼š2025-10-29 AM
æŒç»­æ—¶é•¿ï¼š1å¤©6å°æ—¶
èŠ‚ç‚¹æ•°ï¼š8ä¸ª

ã€å€™é€‰ä¸»é¢˜ 2ã€‘
IDï¼št_456
æ ‡é¢˜ï¼šELLEçº¢æ¯¯
æ‘˜è¦ï¼šELLEé£å°šå¤§å…¸çº¢æ¯¯...
æœ€åæ´»è·ƒï¼š2025-10-29 AM
æŒç»­æ—¶é•¿ï¼š2å¤©

è¦æ±‚è¾“å‡ºJSONï¼š
{
  "decision": "merge" | "new",
  "target_topic_id": "t_123" (if merge),
  "confidence": 0.92,
  "reason": "æ–°äº‹ä»¶æ˜¯è®¸ç»é›„é€ä¸–äº‹ä»¶çš„åç»­æŠ¥é“ï¼ˆå®¶äººå›åº”ï¼‰ï¼Œå±äºåŒä¸€ä¸»é¢˜"
}
```

**åˆ¤å®šæ ‡å‡†**ï¼š
1. **å‘é‡ç›¸ä¼¼åº¦ > 0.80**ï¼šå€™é€‰å¬å›é˜ˆå€¼
2. **LLMåˆ¤å®šç½®ä¿¡åº¦ > 0.75**ï¼šå…³è”ç¡®è®¤é˜ˆå€¼
3. **æ—¶é—´è¿ç»­æ€§**ï¼šä¸€èˆ¬ä¸è¶…è¿‡7å¤©é—´éš”
4. **ä¸»é¢˜ä¸€è‡´æ€§**ï¼šæ˜¯å¦ä¸ºåŒä¸€äº‹ä»¶çš„åç»­è¿›å±•

**LLMå“åº”ç¤ºä¾‹**ï¼š
```json
{
  "decision": "merge",
  "target_topic_id": "t_123",
  "confidence": 0.92,
  "reason": "æ–°äº‹ä»¶æ˜¯è®¸ç»é›„é€ä¸–äº‹ä»¶çš„åç»­æŠ¥é“ï¼ˆå®¶äººå›åº”ï¼‰ï¼Œå±äºåŒä¸€ä¸»é¢˜çš„å»¶ç»­",
  "period": "2025-10-29_PM"
}
```

#### æ­¥éª¤4ï¼šæ‰§è¡Œå½’å¹¶æˆ–æ–°å»º

**4.1 Mergeï¼ˆå½’å…¥å·²æœ‰ä¸»é¢˜ï¼‰**
```python
if decision == "merge":
    target_topic = topics[target_topic_id]
    
    # è¿½åŠ æ—¶é—´çº¿èŠ‚ç‚¹
    for item in group_items:
        node = TopicNode(
            topic_id=target_topic.id,
            source_item_id=item.id,
            appended_at=now()
        )
        target_topic.nodes.append(node)
    
    # æ›´æ–°ä¸»é¢˜ä¿¡æ¯
    target_topic.last_active = now()
    target_topic.intensity_total += len(group_items)
    target_topic.current_heat_normalized = avg(item.heat_normalized for item in group_items)
```

**4.2 Newï¼ˆåˆ›å»ºæ–°ä¸»é¢˜ï¼‰**
```python
else:  # decision == "new"
    new_topic = Topic(
        title_key=representative.title,
        first_seen=representative.fetched_at,
        last_active=now(),
        status='active',
        intensity_total=len(group_items),
        current_heat_normalized=avg(item.heat_normalized for item in group_items)
    )
    
    # åˆ›å»ºé¦–æ‰¹èŠ‚ç‚¹
    for item in group_items:
        node = TopicNode(
            topic_id=new_topic.id,
            source_item_id=item.id,
            appended_at=now()
        )
        new_topic.nodes.append(node)
    
    topics.append(new_topic)
```

#### æ­¥éª¤5ï¼šçƒ­åº¦æ›´æ–°

**5.1 æ›´æ–°ä¸»é¢˜å½“å‰çƒ­åº¦**
```python
topic.current_heat_normalized = avg(
    item.heat_normalized 
    for item in latest_group_items
)
topic.heat_percentage = topic.current_heat_normalized * 100
```

**5.2 è®°å½•åŠæ—¥çƒ­åº¦ï¼ˆtopic_halfday_heatè¡¨ï¼‰**
```sql
INSERT INTO topic_halfday_heat 
    (topic_id, date, period, heat_normalized, heat_percentage, source_count)
VALUES 
    (:topic_id, '2025-10-29', 'PM', 0.08, 8.0, 3)
ON CONFLICT (topic_id, date, period) 
DO UPDATE SET
    heat_normalized = EXCLUDED.heat_normalized,
    heat_percentage = EXCLUDED.heat_percentage,
    source_count = EXCLUDED.source_count;
```

**çƒ­åº¦è¿½è¸ªç¤ºä¾‹**ï¼š
```
Topic: "è®¸ç»é›„é€ä¸–"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Date       â•‘ Period â•‘ Heat_Norm     â•‘ Heat_Percent   â•‘ Source_Count â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ 2025-10-28 â•‘ AM     â•‘ 0.04          â•‘ 4.0%           â•‘ 2            â•‘
â•‘ 2025-10-28 â•‘ PM     â•‘ 0.06          â•‘ 6.0%           â•‘ 4            â•‘
â•‘ 2025-10-28 â•‘ EVE    â•‘ 0.09          â•‘ 9.0%           â•‘ 6            â•‘
â•‘ 2025-10-29 â•‘ AM     â•‘ 0.12 (å³°å€¼)   â•‘ 12.0%          â•‘ 8            â•‘
â•‘ 2025-10-29 â•‘ PM     â•‘ 0.08          â•‘ 8.0%           â•‘ 5            â•‘
â•‘ 2025-10-29 â•‘ EVE    â•‘ 0.05          â•‘ 5.0%           â•‘ 3            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è¶‹åŠ¿ï¼šé¦–æ—¥ç¼“æ…¢å‘é…µ â†’ å‚æ™šå¼€å§‹å‡æ¸© â†’ æ¬¡æ—¥ä¸Šåˆè¾¾åˆ°å³°å€¼ â†’ ä¸‹åˆå¼€å§‹å›è½ â†’ å‚æ™šç»§ç»­é™æ¸©
```

#### æ­¥éª¤6ï¼šåˆ†ç±»ä¸æ‘˜è¦ï¼ˆLLMï¼‰

**6.1 è‡ªåŠ¨åˆ†ç±»**
```python
# è§„åˆ™æ‰“åˆ†
entertainment_score = count_keywords(title, ["æ˜æ˜Ÿ", "ç»¼è‰º", "ç”µå½±", "å…«å¦"])
current_affairs_score = count_keywords(title, ["æ”¿ç­–", "äº‹æ•…", "æ°‘ç”Ÿ"])
sports_score = count_keywords(title, ["æ¯”èµ›", "çƒå‘˜", "ç”µç«"])

if max_score < 0.6:
    # è°ƒç”¨LLMåˆ†ç±»
    category_result = llm_classify(topic)
    topic.category = category_result.label
    topic.category_confidence = category_result.confidence
else:
    # ä½¿ç”¨è§„åˆ™ç»“æœ
    topic.category = argmax(scores)
```

**åˆ†ç±»ç¤ºä¾‹**ï¼š
```
"æ¬¢å–œå“¥è®¸ç»é›„é€ä¸–" â†’ entertainment (å¨±ä¹å…«å¦)
"åäº”äº”è§„åˆ’å»ºè®®å…¬å¸ƒ" â†’ current_affairs (ç¤¾ä¼šæ—¶äº‹)
"æ¨ç€šæ£®NBAå¾—åˆ†è¶…è¶Šå­™æ‚¦" â†’ sports_esports (ä½“è‚²ç”µç«)
```

**6.2 å¢é‡æ‘˜è¦**
```python
# ä»…å¯¹æ–°å¢èŠ‚ç‚¹åšæ‘˜è¦
new_nodes_summary = llm_summarize(new_nodes)

# ä¸å†å²æ‘˜è¦åˆæˆ
if topic.summary:
    updated_summary = llm_merge_summaries(
        old=topic.summary.content,
        new=new_nodes_summary
    )
else:
    updated_summary = new_nodes_summary

topic.summary = Summary(
    content=updated_summary,
    method='incremental'
)
```

#### æ­¥éª¤7ï¼šå‘é‡ç´¢å¼•

```python
# å°†æ–°èŠ‚ç‚¹å’Œæ‘˜è¦å‘é‡åŒ–
for node in new_nodes:
    embedding = embedding_model.encode(node.title + " " + node.summary)
    Embedding.create(
        object_type='topic_node',
        object_id=node.id,
        vector=embedding
    )

if topic.summary:
    summary_embedding = embedding_model.encode(topic.summary.content)
    Embedding.create(
        object_type='topic_summary',
        object_id=topic.summary.id,
        vector=summary_embedding
    )
```

#### æ­¥éª¤8ï¼šæŒ‡æ ‡èšåˆä¸å‰ç«¯é€šçŸ¥

```python
# æ›´æ–°åˆ†ç±»èšåˆæŒ‡æ ‡
update_category_day_metrics(date=today)

# é€šçŸ¥å‰ç«¯ï¼ˆWebSocketæˆ–è½®è¯¢ï¼‰
notify_frontend({
    'type': 'topics_updated',
    'timestamp': now(),
    'updated_topics': [topic.id],
    'new_topics': [new_topic.id] if new else []
})
```

### è¾“å‡º
- æ›´æ–°åçš„ `topics` è¡¨
- æ–°å¢çš„ `topic_nodes`
- æ›´æ–°çš„ `topic_halfday_heat` è®°å½•
- å‰ç«¯å®æ—¶æ›´æ–°é€šçŸ¥

## å®æµ‹æ•ˆæœåˆ†æ

> **è¯´æ˜**ï¼šä»¥ä¸‹æ•°æ®åŸºäºæ—©æœŸä¸¤é˜¶æ®µå½’å¹¶ï¼ˆä¸ŠåŠæ—¥/ä¸‹åŠæ—¥ï¼‰æ¨¡å‹çš„æµ‹è¯•ç»“æœï¼Œä»…ä½œä¸ºå‚è€ƒã€‚å½“å‰ç³»ç»Ÿå·²å‡çº§ä¸ºä¸‰é˜¶æ®µå½’å¹¶ï¼ˆä¸Šåˆ/ä¸‹åˆ/å‚æ™šï¼‰æ¨¡å‹ã€‚

### æµ‹è¯•æ•°æ®é›†
- æ—¶é—´ï¼š2025-10-28
- é‡‡é›†æ¬¡æ•°ï¼š6æ¬¡ï¼ˆæ¨¡æ‹Ÿå…¨æ—¥é‡‡é›†ï¼‰
- åŸå§‹æ•°æ®ï¼š918æ¡

### å½’å¹¶ç»“æœ

#### ä¸ŠåŠæ—¥å½’å¹¶ï¼ˆbatch 1-3ï¼‰
```
è¾“å…¥ï¼š459æ¡åŸå§‹æ•°æ®
  â†“ çƒ­åº¦å½’ä¸€åŒ–
  â†“ æ ‡é¢˜èšç±»ï¼ˆ227ä¸ªç»„ï¼‰
  â†“ å‡ºç°æ¬¡æ•°ç­›é€‰ï¼ˆâ‰¥2æ¬¡ï¼‰
è¾“å‡ºï¼š359æ¡ä¿ç•™ï¼ˆ127ä¸ªäº‹ä»¶ç»„ï¼‰
ä¸¢å¼ƒï¼š100æ¡ï¼ˆ21.8%å™ªéŸ³ï¼‰
```

#### ä¸ŠåŠæ—¥æ•´ä½“å½’å¹¶
```
è¾“å…¥ï¼š127ä¸ªäº‹ä»¶ç»„
  â†“ å‘é‡æ£€ç´¢ï¼ˆæ— å·²æœ‰ä¸»é¢˜ï¼‰
  â†“ LLMåˆ¤å®š
è¾“å‡ºï¼š127ä¸ªæ–°ä¸»é¢˜ï¼ˆå…¨éƒ¨NEWï¼‰
```

#### ä¸‹åŠæ—¥å½’å¹¶ï¼ˆbatch 4-6ï¼‰
```
è¾“å…¥ï¼š459æ¡åŸå§‹æ•°æ®
  â†“ çƒ­åº¦å½’ä¸€åŒ–
  â†“ æ ‡é¢˜èšç±»ï¼ˆ214ä¸ªç»„ï¼‰
  â†“ å‡ºç°æ¬¡æ•°ç­›é€‰ï¼ˆâ‰¥2æ¬¡ï¼‰
è¾“å‡ºï¼š377æ¡ä¿ç•™ï¼ˆ132ä¸ªäº‹ä»¶ç»„ï¼‰
ä¸¢å¼ƒï¼š82æ¡ï¼ˆ17.9%å™ªéŸ³ï¼‰
```

#### ä¸‹åŠæ—¥æ•´ä½“å½’å¹¶
```
è¾“å…¥ï¼š132ä¸ªäº‹ä»¶ç»„ + 127ä¸ªå·²æœ‰ä¸»é¢˜
  â†“ å‘é‡æ£€ç´¢
  â†“ LLMåˆ¤å®š
è¾“å‡ºï¼š
  - 56ä¸ªMERGEï¼ˆå½’å…¥å·²æœ‰ä¸»é¢˜ï¼‰
  - 76ä¸ªNEWï¼ˆåˆ›å»ºæ–°ä¸»é¢˜ï¼‰
  - Mergeç‡ï¼š42.4%

æœ€ç»ˆï¼š203ä¸ªä¸»é¢˜
```

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|-----|------|------|
| **æ•°æ®å‹ç¼©æ¯”** | 4.5:1 | 918æ¡åŸå§‹æ•°æ® â†’ 203ä¸ªä¸»é¢˜ |
| **å™ªéŸ³è¿‡æ»¤ç‡** | 19.8% | 182æ¡å•æ¬¡å‡ºç°äº‹ä»¶è¢«ä¸¢å¼ƒ |
| **ä¿ç•™ç‡** | 80.2% | 736æ¡æ•°æ®é€šè¿‡æ–°äº‹ä»¶å½’å¹¶ç­›é€‰ |
| **Mergeç‡** | 42.4% | åç»­å½’å¹¶ä¸­æœ‰42.4%äº‹ä»¶å½’å…¥å·²æœ‰ä¸»é¢˜ |
| **è·¨æ‰¹æ¬¡å æ¯”** | 95.6% | 194/203ä¸ªä¸»é¢˜è·¨è¶Šå¤šä¸ªæ‰¹æ¬¡ |
| **å¹³å‡èŠ‚ç‚¹æ•°** | 3.63 | æ¯ä¸ªä¸»é¢˜å¹³å‡3.63ä¸ªæºæ•°æ®èŠ‚ç‚¹ |
| **å¹³å‡å¹³å°æ•°** | 1.25 | æ¯ä¸ªä¸»é¢˜å¹³å‡è¦†ç›–1.25ä¸ªå¹³å° |

### çƒ­åº¦TOP 5ä¸»é¢˜

| æ’å | ä¸»é¢˜æ ‡é¢˜ | æ‰¹æ¬¡èŒƒå›´ | èŠ‚ç‚¹æ•° | å¹³å°æ•° | ç´¯è®¡çƒ­åº¦ |
|-----|---------|---------|-------|-------|---------|
| 1 | "åäº”äº”"è§„åˆ’å»ºè®®å…¬å¸ƒ | 1-6 | 14 | 4 | 0.048 |
| 2 | é²è¿…é•¿å­™åŠå”è®¸ç»é›„ | 1-6 | 12 | 2 | 0.042 |
| 3 | ä½˜è¯—æ›¼ï¼šä¼šç…§é¡¾è®¸ç»é›„å®¶äºº | 1-6 | 6 | 1 | 0.040 |
| 4 | å¥³å­å¾’æ­¥è¯¯è¸©è›‡çª | 1-6 | 6 | 1 | 0.039 |
| 5 | ELLEçº¢æ¯¯ | 1-6 | 12 | 1 | 0.039 |

### æŒç»­æ€§åˆ†æ

**æŒç»­æ—¶é—´æœ€é•¿çš„TOP 10ä¸»é¢˜ï¼ˆå…¨éƒ¨è·¨è¶Š5ä¸ªæ‰¹æ¬¡ï¼‰**ï¼š
1. ELLEçº¢æ¯¯ - å¾®åšæŒç»­æŠ¥é“
2. æ¬¢å–œå“¥è®¸ç»é›„é€ä¸– - å¤šå¹³å°æŒç»­å…³æ³¨
3. åŠ¨ç‰©è¡€åº“ç°è‰²äº§ä¸š - ç¤¾ä¼šé—®é¢˜æŒç»­å‘é…µ
4. ç½‘çº¢è¢«è›‡å’¬å¤±è” - äº‹ä»¶æŒç»­è¿½è¸ª
5. ä»£éœ²å¨ƒæ‘”äº† - å¨±ä¹è¯é¢˜æŒç»­è®¨è®º
6. å¥³å­å¾’æ­¥è¯¯è¸©è›‡çª - çƒ­é—¨è¯é¢˜æŒç»­ä¼ æ’­
7. æ²ªæŒ‡ç ´4000ç‚¹ - è´¢ç»çƒ­ç‚¹æŒç»­è®¨è®º
8. 76å²TVBæ¼”å‘˜è®¸ç»é›„ç—…é€ - çŸ¥ä¹æ·±åº¦è®¨è®º
9. ç†Šå­©å­è¯¯åé‡‘è±† - ç¤¾ä¼šäº‹ä»¶æŒç»­å…³æ³¨
10. ç®—åŠ›å¤ç°äººè„‘æ„è¯† - ç§‘æŠ€è¯é¢˜æŒç»­æ¢è®¨

## ä¼˜åŒ–å»ºè®®

### 1. ç›¸ä¼¼åº¦é˜ˆå€¼è°ƒä¼˜
- **æ–°äº‹ä»¶å½’å¹¶é˜ˆå€¼ï¼ˆ0.85ï¼‰**ï¼šå¯æ ¹æ®å¹³å°ç‰¹æ€§è°ƒæ•´
  - å¾®åšæ ‡é¢˜çŸ­ï¼Œå¯é€‚å½“é™ä½è‡³0.80
  - çŸ¥ä¹æ ‡é¢˜é•¿ï¼Œå¯ä¿æŒ0.85
- **æ•´ä½“å½’å¹¶é˜ˆå€¼ï¼ˆ0.80ï¼‰**ï¼šå…è®¸äº‹ä»¶æ¼”è¿›
  - å¯æ ¹æ®ä¸»é¢˜æ´»è·ƒæ—¶é•¿åŠ¨æ€è°ƒæ•´
  - è€æ—§ä¸»é¢˜ï¼ˆ>7å¤©ï¼‰å¯æé«˜é˜ˆå€¼è‡³0.85

### 2. å‡ºç°æ¬¡æ•°é˜ˆå€¼è°ƒä¼˜
- **å½“å‰é˜ˆå€¼ï¼šâ‰¥2æ¬¡**
  - ä¸Šåˆï¼ˆ3æ¬¡é‡‡é›†ï¼‰ï¼š2/3 = 66.7%è¦†ç›–ç‡
  - ä¸‹åˆï¼ˆ3æ¬¡é‡‡é›†ï¼‰ï¼š2/3 = 66.7%è¦†ç›–ç‡
  - å‚æ™šï¼ˆ2æ¬¡é‡‡é›†ï¼‰ï¼š2/2 = 100%è¦†ç›–ç‡
- **å¯é€‰ç­–ç•¥**ï¼š
  - åŠ¨æ€é˜ˆå€¼ï¼šä¸Šåˆ/ä¸‹åˆâ‰¥2ï¼Œå‚æ™šâ‰¥2ï¼ˆä¿æŒä¸€è‡´ï¼‰
  - ç™¾åˆ†æ¯”é˜ˆå€¼ï¼šå‡ºç°æ¬¡æ•° â‰¥ é‡‡é›†æ¬¡æ•° * 50%ï¼ˆä½†å‚æ™šéœ€è°ƒæ•´ä¸º100%ï¼‰

### 3. å¹³å°æƒé‡è°ƒä¼˜
- å½“å‰æƒé‡åŸºäºä¸»è§‚è¯„ä¼°
- å»ºè®®æ ¹æ®å®æµ‹æ•°æ®è°ƒæ•´ï¼š
  - ç»Ÿè®¡å„å¹³å°çƒ­ç‚¹çš„å‡†ç¡®ç‡
  - åˆ†æå„å¹³å°çƒ­ç‚¹çš„æŒç»­æ€§
  - åŠ¨æ€è°ƒæ•´æƒé‡é…ç½®

### 4. LLMæ€§èƒ½ä¼˜åŒ–
- **æ‰¹é‡å¤„ç†**ï¼š10-20ä¸ªåˆ¤å®šåˆå¹¶ä¸º1ä¸ªprompt
- **ç¼“å­˜å¤ç”¨**ï¼šç›¸åŒè¾“å…¥ç¼“å­˜ç»“æœï¼ˆTTL=1hï¼‰
- **å¹¶å‘æ§åˆ¶**ï¼šé™åˆ¶å¹¶å‘æ•°é¿å…OOM
- **è¶…æ—¶å¤„ç†**ï¼šè®¾ç½®åˆç†è¶…æ—¶ï¼ˆ30sï¼‰ï¼Œå¤±è´¥é™çº§ä¸ºå‘é‡åˆ¤å®š

### 5. å‘é‡æ£€ç´¢ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**ï¼špgvectorä½¿ç”¨HNSWç´¢å¼•
- **æ‰¹é‡æ£€ç´¢**ï¼šä¸€æ¬¡æ£€ç´¢å¤šä¸ªæ–°äº‹ä»¶
- **é¢„è¿‡æ»¤**ï¼šå…ˆæŒ‰æ—¶é—´ã€åˆ†ç±»é¢„ç­›é€‰å€™é€‰é›†

## æŠ€æœ¯å®ç°å»ºè®®

### æ•°æ®åº“è®¾è®¡

```sql
-- source_items è¡¨
CREATE TABLE source_items (
    id SERIAL PRIMARY KEY,
    platform VARCHAR(20) NOT NULL,
    title TEXT NOT NULL,
    summary TEXT,
    url TEXT,
    heat_value FLOAT,                        -- åŸå§‹çƒ­åº¦å€¼ï¼ˆå¯ç©ºï¼‰
    heat_normalized FLOAT,                   -- å½’ä¸€åŒ–çƒ­åº¦ï¼ˆ0-1ï¼‰
    halfday_merge_group_id VARCHAR(50),      -- åŠæ—¥å½’å¹¶ç»„ID
    halfday_period VARCHAR(20),              -- AM/PM/EVE
    occurrence_count INT,                    -- å‡ºç°æ¬¡æ•°
    fetched_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- topics è¡¨
CREATE TABLE topics (
    id SERIAL PRIMARY KEY,
    title_key TEXT NOT NULL,
    first_seen TIMESTAMP NOT NULL,
    last_active TIMESTAMP NOT NULL,
    status VARCHAR(10) DEFAULT 'active',     -- active/ended
    category VARCHAR(20),                    -- entertainment/current_affairs/sports_esports
    intensity_total INT DEFAULT 0,
    interaction_total BIGINT DEFAULT 0,
    current_heat_normalized FLOAT,           -- å½“å‰å½’ä¸€åŒ–çƒ­åº¦
    created_at TIMESTAMP DEFAULT NOW()
);

-- topic_halfday_heat è¡¨
CREATE TABLE topic_halfday_heat (
    id SERIAL PRIMARY KEY,
    topic_id INT REFERENCES topics(id),
    date DATE NOT NULL,
    period VARCHAR(3) NOT NULL,              -- AM/PM/EVE
    heat_normalized FLOAT NOT NULL,
    heat_percentage FLOAT NOT NULL,
    source_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(topic_id, date, period)
);

-- topic_nodes è¡¨
CREATE TABLE topic_nodes (
    id SERIAL PRIMARY KEY,
    topic_id INT REFERENCES topics(id),
    source_item_id INT REFERENCES source_items(id),
    appended_at TIMESTAMP NOT NULL
);

-- embeddings è¡¨ï¼ˆpgvectorï¼‰
CREATE TABLE embeddings (
    id SERIAL PRIMARY KEY,
    object_type VARCHAR(20) NOT NULL,        -- source_item/topic_node/topic_summary
    object_id INT NOT NULL,
    provider VARCHAR(50) NOT NULL,
    model VARCHAR(100) NOT NULL,
    vector vector(768),                      -- Qwen3-Embedding-8B: 768ç»´
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_embeddings_vector ON embeddings USING hnsw (vector vector_cosine_ops);
```

### Celeryä»»åŠ¡è°ƒåº¦

```python
# celery_app.py
from celery import Celery
from celery.schedules import crontab

app = Celery('echoman', broker='redis://localhost:6379/0')

# é‡‡é›†ä»»åŠ¡ï¼šæ¯2å°æ—¶æ‰§è¡Œ
@app.task
def ingest_task():
    """8:00-22:00 æ¯2å°æ—¶æ‰§è¡Œ"""
    from scrapers import run_all_scrapers
    return run_all_scrapers()

# æ–°äº‹ä»¶å½’å¹¶ä»»åŠ¡ï¼š12:15ã€18:15å’Œ22:15æ‰§è¡Œ
@app.task
def halfday_merge_task(period: str):
    """æ–°äº‹ä»¶å½’å¹¶ï¼šAM/PM/EVE"""
    from merge import halfday_merge
    return halfday_merge(period=period)

# æ•´ä½“å½’å¹¶ä»»åŠ¡ï¼š12:30ã€18:30å’Œ22:30æ‰§è¡Œ
@app.task
def global_merge_task(period: str):
    """æ•´ä½“å½’å¹¶ï¼šAM/PM/EVE"""
    from merge import global_merge
    return global_merge(period=period)

# å®šæ—¶é…ç½®
app.conf.beat_schedule = {
    'ingest-08': {'task': 'ingest_task', 'schedule': crontab(hour=8, minute=0)},
    'ingest-10': {'task': 'ingest_task', 'schedule': crontab(hour=10, minute=0)},
    'ingest-12': {'task': 'ingest_task', 'schedule': crontab(hour=12, minute=0)},
    'ingest-14': {'task': 'ingest_task', 'schedule': crontab(hour=14, minute=0)},
    'ingest-16': {'task': 'ingest_task', 'schedule': crontab(hour=16, minute=0)},
    'ingest-18': {'task': 'ingest_task', 'schedule': crontab(hour=18, minute=0)},
    'ingest-20': {'task': 'ingest_task', 'schedule': crontab(hour=20, minute=0)},
    'ingest-22': {'task': 'ingest_task', 'schedule': crontab(hour=22, minute=0)},
    
    'halfday-merge-am': {
        'task': 'halfday_merge_task',
        'schedule': crontab(hour=12, minute=15),
        'args': ('AM',)
    },
    'halfday-merge-pm': {
        'task': 'halfday_merge_task',
        'schedule': crontab(hour=18, minute=15),
        'args': ('PM',)
    },
    'halfday-merge-eve': {
        'task': 'halfday_merge_task',
        'schedule': crontab(hour=22, minute=15),
        'args': ('EVE',)
    },
    
    'global-merge-am': {
        'task': 'global_merge_task',
        'schedule': crontab(hour=12, minute=30),
        'args': ('AM',)
    },
    'global-merge-pm': {
        'task': 'global_merge_task',
        'schedule': crontab(hour=18, minute=30),
        'args': ('PM',)
    },
    'global-merge-eve': {
        'task': 'global_merge_task',
        'schedule': crontab(hour=22, minute=30),
        'args': ('EVE',)
    },
}
```

## ç›¸å…³æ–‡æ¡£

- [ECHO_METRICS_CALCULATION.md](ECHO_METRICS_CALCULATION.md): å›å£°æŒ‡æ ‡è®¡ç®—ï¼ˆå«çƒ­åº¦å½’ä¸€åŒ–è¯¦è§£ï¼‰
- [backend-solution.md](backend-solution.md): åç«¯æ–¹æ¡ˆè®¾è®¡
- [api-spec.md](api-spec.md): APIæ¥å£æ–‡æ¡£
- [backend/README.md](../backend/README.md): åç«¯å®ç°è¯´æ˜
- [backend/test_merge.py](../backend/test_merge.py): å½’å¹¶é€»è¾‘æµ‹è¯•è„šæœ¬

## æ€»ç»“

æ¯æ—¥ä¸‰æ¬¡ã€æ¯æ¬¡ä¸¤é˜¶æ®µçš„å½’å¹¶æœºåˆ¶é€šè¿‡**æ–°äº‹ä»¶éªŒè¯**å’Œ**æ•´ä½“å…³è”**ä¸¤ä¸ªé˜¶æ®µï¼Œæœ‰æ•ˆè§£å†³äº†å¤šå¹³å°çƒ­ç‚¹æ•°æ®çš„å™ªéŸ³è¿‡æ»¤å’Œä¸»é¢˜è¿½è¸ªé—®é¢˜ï¼š

1. **é˜¶æ®µä¸€ï¼šæ–°äº‹ä»¶å½’å¹¶**ï¼šåŸºäºå‡ºç°æ¬¡æ•°çš„å™ªéŸ³è¿‡æ»¤ï¼ˆè¿‡æ»¤19.8%ï¼‰ï¼ŒéªŒè¯çœŸå®çƒ­ç‚¹
2. **é˜¶æ®µäºŒï¼šæ•´ä½“å½’å¹¶**ï¼šåŸºäºç›¸ä¼¼åº¦çš„ä¸»é¢˜å…³è”ï¼ˆMergeç‡42.4%ï¼‰ï¼Œæ„å»ºæ¼”è¿›æ—¶é—´çº¿
3. **çƒ­åº¦å½’ä¸€åŒ–**ï¼šç»Ÿä¸€é‡çº²ï¼Œä½“ç°å¹³å°å½±å“åŠ›ï¼Œæ”¯æŒè·¨å¹³å°å¯¹æ¯”
4. **ä¸‰æ¬¡æ‰§è¡Œ**ï¼šæ¯æ—¥åœ¨ä¸Šåˆï¼ˆ12:15ï¼‰ã€ä¸‹åˆï¼ˆ18:15ï¼‰ã€å‚æ™šï¼ˆ22:15ï¼‰å„æ‰§è¡Œä¸€æ¬¡å®Œæ•´å½’å¹¶
5. **å®æµ‹éªŒè¯**ï¼šæ•°æ®å‹ç¼©æ¯”4.5:1ï¼Œè·¨æ‰¹æ¬¡å æ¯”95.6%ï¼Œè¯æ˜æ–¹æ¡ˆæœ‰æ•ˆæ€§

è¯¥å½’å¹¶æœºåˆ¶ä¸ºåç»­çš„AIå¤„ç†ï¼ˆæ‘˜è¦ã€åˆ†ç±»ã€RAGå¯¹è¯ï¼‰å¥ å®šäº†åšå®çš„æ•°æ®åŸºç¡€ã€‚

