# LLM摘要生成提示词示例

## 📋 完整Prompt模板

### 1. 全量摘要生成 (Full Summary)

**使用场景**：Topic首次生成摘要时

**Prompt模板**：
```
请为以下热点事件生成结构化摘要。

【事件基本信息】
- 标题: {topic.title_key}
- 首次发现: {topic.first_seen}
- 最后活跃: {topic.last_active}
- 涉及平台: {platforms}
- 节点总数: {node_count}

【关键节点】（按时间顺序，已筛选关键信息）
1. [平台名称] 时间
   标题: 节点标题
   摘要: 节点摘要内容
   互动: 互动数据

2. [平台名称] 时间
   标题: 节点标题
   摘要: 节点摘要内容
   互动: 互动数据

... (最多15个关键节点)

要求：
1. 概述事件的核心内容（150-300字）
2. 提炼3-5个关键要点
3. 如果有重要进展，按时间顺序说明
4. 保持客观中立，不做主观评价

重要：直接返回JSON格式，不要包含任何思维过程或其他文本。
输出格式：
{
  "summary": "事件概述（150-300字）",
  "key_points": [
    "要点1：事件起因或背景",
    "要点2：主要内容或进展",
    "要点3：当前状态或影响"
  ]
}
```

---

## 📝 真实示例1：体育赛事

**Topic**: "湖人上次在前九场取得7胜2负还是19-20赛季，当赛季最终夺冠"

**输入Prompt**：
```
请为以下热点事件生成结构化摘要。

【事件基本信息】
- 标题: 湖人上次在前九场取得7胜2负还是19-20赛季，当赛季最终夺冠
- 首次发现: 2025-11-07 20:45
- 最后活跃: 2025-11-07 22:00
- 涉及平台: ['hupu']
- 节点总数: 2

【关键节点】（按时间顺序，已筛选关键信息）
1. [hupu] 2025-11-07 20:45
   标题: 7[流言板]湖人上次在前九场取得7胜2负还是19-20赛季，当赛季最终夺冠
   摘要: 湖人队在本赛季前九场比赛取得7胜2负的战绩，这与2019-20赛季开局战绩相同
   互动: 回复125次

2. [hupu] 2025-11-07 22:00
   标题: 5[流言板]湖人上次在前九场取得7胜2负还是19-20赛季，当赛季最终夺冠
   摘要: 19-20赛季湖人同样以7胜2负开局，最终夺得NBA总冠军
   互动: 回复89次

要求：
1. 概述事件的核心内容（150-300字）
2. 提炼3-5个关键要点
3. 如果有重要进展，按时间顺序说明
4. 保持客观中立，不做主观评价

重要：直接返回JSON格式，不要包含任何思维过程或其他文本。
输出格式：
{
  "summary": "事件概述（150-300字）",
  "key_points": [
    "要点1：事件起因或背景",
    "要点2：主要内容或进展",
    "要点3：当前状态或影响"
  ]
}
```

**LLM响应**：
```json
{
  "summary": "2025年11月7日，虎扑平台用户讨论指出，洛杉矶湖人队在2025赛季前九场比赛中取得7胜2负的战绩，这一开局成绩与球队历史上的19-20赛季（2019-2020赛季）高度相似。19-20赛季湖人同样以7胜2负开启赛季，并最终夺得NBA总冠军。该话题在当日20:45首次被提及，随后在22:00再次引发讨论，节点总数为2次。用户主要关注湖人当前赛季表现与历史夺冠赛季的关联性，但未涉及具体战术或球员表现细节。",
  "key_points": [
    "数据对比：湖人2025赛季前九场7胜2负，与19-20赛季开局战绩一致",
    "历史参照：19-20赛季湖人以相同开局最终夺冠",
    "球迷关注：期待本赛季重现夺冠表现"
  ]
}
```

---

## 📝 真实示例2：时事新闻

**Topic**: "安徽省二胎补贴被追回"

**输入Prompt**：
```
请为以下热点事件生成结构化摘要。

【事件基本信息】
- 标题: 安徽省二胎补贴被追回
- 首次发现: 2025-11-07 22:00
- 最后活跃: 2025-11-07 22:00
- 涉及平台: ['新浪网', '微博']
- 节点总数: 2

【关键节点】（按时间顺序，已筛选关键信息）
1. [新浪网] 2025-11-07 22:00
   标题: 安徽省二胎补贴被追回
   摘要: 安徽省相关部门对已发放的二胎补贴进行追缴
   互动: 阅读1200次

2. [微博] 2025-11-07 22:00
   标题: #安徽二胎补贴#
   摘要: 安徽省启动二胎家庭补贴资金追缴程序
   互动: 转发89次, 评论156条

要求：
1. 概述事件的核心内容（150-300字）
2. 提炼3-5个关键要点
3. 如果有重要进展，按时间顺序说明
4. 保持客观中立，不做主观评价

重要：直接返回JSON格式，不要包含任何思维过程或其他文本。
输出格式：
{
  "summary": "事件概述（150-300字）",
  "key_points": [
    "要点1：事件起因或背景",
    "要点2：主要内容或进展",
    "要点3：当前状态或影响"
  ]
}
```

**LLM响应**：
```json
{
  "summary": "安徽省近日被曝出现二胎补贴被追回事件，引发社会关注。根据现有信息，相关部门对已发放的二胎补贴进行追缴，具体涉及人数及金额尚未明确披露。事件可能与政策执行或资金管理问题相关，但官方尚未公布详细原因。目前，该事件在微博、新浪等平台传播，舆论对政策调整背景及后续处理方案存在讨论需求。",
  "key_points": [
    "事件背景：安徽省启动二胎补贴追缴程序",
    "信息缺口：具体原因、涉及人数和金额未披露",
    "社会反响：在多平台传播，引发政策讨论"
  ]
}
```

---

## 🔄 增量摘要更新 (Incremental Update)

**使用场景**：Topic有新节点时更新现有摘要

**Prompt模板**：
```
请基于当前摘要和新增进展，更新事件摘要。

【当前摘要】
{current_summary}

【新增进展】（{n}条新节点）
1. [平台] 时间
   标题内容
   摘要内容

2. [平台] 时间
   标题内容
   摘要内容

请分析新增内容，判断是否需要更新摘要。

更新原则：
1. 如果新节点只是重复旧信息，保持原摘要不变
2. 如果有重要新进展或转折，更新摘要并添加新要点
3. 保持摘要简洁（150-300字）
4. 保留历史摘要的连贯性

重要：直接返回JSON格式，不要包含任何思维过程或其他文本。
输出格式：
{
  "needs_update": true,
  "updated_summary": "更新后的摘要（如果needs_update=true）",
  "new_key_points": ["新增要点1", "新增要点2"],
  "change_reason": "说明为什么需要更新（或为什么不需要）"
}
```

---

## ⚙️ Prompt设计原则

### 1. 结构化输入
- **事件基本信息**：提供Topic的元数据（标题、时间、平台）
- **关键节点**：按时间顺序排列，包含标题、摘要、互动数据
- **节点筛选**：最多15个（首条 + 峰值 + 最新）

### 2. 明确要求
- **字数限制**：150-300字（适合摘要展示）
- **结构要求**：概述 + 3-5个关键要点
- **时间顺序**：如有进展，按时序说明
- **客观中立**：不做主观评价

### 3. 格式规范
- **JSON输出**：便于程序解析
- **禁止思维链**：Qwen模型可能输出`<think>`标签，需要明确禁止
- **固定schema**：`summary` + `key_points`

### 4. Token优化
- **最大输入**：4000 tokens（系统会自动截断）
- **最大输出**：1000 tokens
- **节点压缩**：摘要截取前150字符

---

## 🔧 技术参数

```python
# LLM调用参数
temperature = 0.3        # 偏保守，减少幻觉
max_tokens = 1000        # 摘要最多1000 tokens
model = "Qwen3-32B"      # 本地部署的模型

# Token管理
max_prompt_tokens = 4000     # 输入上限
max_completion_tokens = 1000  # 输出上限
```

---

## 📊 质量保证机制

### 1. 响应解析
- 提取JSON内容（忽略`<think>`标签）
- 降级处理：JSON解析失败时提取纯文本
- 异常处理：创建placeholder摘要

### 2. 向量生成
- 基于`summary.content`生成向量
- 使用`Qwen3-Embedding-8B`模型
- 同步保存到PostgreSQL和ChromaDB

### 3. 日志记录
- 记录完整的request/response到`llm_judgements`表
- 保留prompt前1000字符用于审计
- 记录token使用量统计

---

## 🎯 实际效果

**生成的摘要特点**：
- ✅ 事实准确（基于真实节点数据）
- ✅ 结构清晰（时间/地点/人物/经过）
- ✅ 客观中立（无主观评价）
- ✅ 信息完整（涵盖关键要点）
- ✅ 语言流畅（自然的中文表达）

**平均生成指标**：
- 摘要长度：150-300字
- 生成时间：~15秒/个（包含LLM调用）
- Token消耗：~5000 tokens/个（输入+输出）
- 向量维度：取决于Embedding模型

