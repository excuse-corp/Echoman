#!/bin/bash

echo "=========================================="
echo "  10ç‚¹å½’å¹¶ä»»åŠ¡å®æ—¶ç›‘æ§"
echo "  Real-time Monitoring for 10:00 Merge"
echo "=========================================="
echo ""

# é¢œè‰²å®šä¹‰
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# æ£€æŸ¥æ—¶é—´
current_time=$(date +"%H:%M")
echo "ğŸ“… å½“å‰æ—¶é—´: $current_time"
echo ""

# 1. ç›‘æ§Celeryä»»åŠ¡æ—¥å¿—
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ ç›‘æ§ä»»åŠ¡æ‰§è¡Œæ—¥å¿— (Ctrl+Cåœæ­¢)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "å…³é”®æ—¶é—´ç‚¹ï¼š"
echo "  10:00 - é‡‡é›†ä»»åŠ¡"
echo "  10:15 - å½’å¹¶é˜¶æ®µä¸€"
echo "  10:30 - å½’å¹¶é˜¶æ®µäºŒ"
echo ""

# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f /root/ren/Echoman/backend/celery_worker.log | grep --line-buffered -E "å¼€å§‹æ‰§è¡Œå®šæ—¶é‡‡é›†ä»»åŠ¡|å¼€å§‹æ‰§è¡Œæ–°äº‹ä»¶å½’å¹¶ä»»åŠ¡|å¼€å§‹æ‰§è¡Œæ•´ä½“å½’å¹¶ä»»åŠ¡|é‡‡é›†ä»»åŠ¡å®Œæˆ|å½’å¹¶é˜¶æ®µä¸€.*å®Œæˆ|å½’å¹¶é˜¶æ®µäºŒ.*å®Œæˆ|2025-11-07_10|è€—æ—¶" | while read line; do
    if [[ $line == *"å¼€å§‹æ‰§è¡Œ"* ]]; then
        echo -e "${GREEN}[$(date +"%H:%M:%S")] $line${NC}"
    elif [[ $line == *"å®Œæˆ"* ]]; then
        echo -e "${YELLOW}[$(date +"%H:%M:%S")] $line${NC}"
    elif [[ $line == *"2025-11-07_10"* ]]; then
        echo -e "${GREEN}[$(date +"%H:%M:%S")] âœ… Periodæ ¼å¼æ­£ç¡®: $line${NC}"
    else
        echo "[$(date +"%H:%M:%S")] $line"
    fi
done

